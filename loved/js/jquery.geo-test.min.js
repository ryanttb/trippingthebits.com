document.createElement("canvas").getContext||function(){function e(){return this.context_||(this.context_=new t(this))}function q(p,h){var o=H.call(arguments,2);return function(){return p.apply(h,o.concat(H.call(arguments)))}}function r(p){p.namespaces.g_vml_||p.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");p.namespaces.g_o_||p.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!p.styleSheets.ex_canvas_){p=p.createStyleSheet();p.owningElement.id=
"ex_canvas_";p.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function b(p){var h=p.srcElement;switch(p.propertyName){case "width":h.getContext().clearRect();h.style.width=h.attributes.width.nodeValue+"px";h.firstChild.style.width=h.clientWidth+"px";break;case "height":h.getContext().clearRect();h.style.height=h.attributes.height.nodeValue+"px";h.firstChild.style.height=h.clientHeight+"px"}}function c(p){p=p.srcElement;if(p.firstChild){p.firstChild.style.width=
p.clientWidth+"px";p.firstChild.style.height=p.clientHeight+"px"}}function a(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(p,h){for(var o=a(),s=0;s<3;s++)for(var x=0;x<3;x++){for(var w=0,A=0;A<3;A++)w+=p[s][A]*h[A][x];o[s][x]=w}return o}function g(p,h){h.fillStyle=p.fillStyle;h.lineCap=p.lineCap;h.lineJoin=p.lineJoin;h.lineWidth=p.lineWidth;h.miterLimit=p.miterLimit;h.shadowBlur=p.shadowBlur;h.shadowColor=p.shadowColor;h.shadowOffsetX=p.shadowOffsetX;h.shadowOffsetY=p.shadowOffsetY;h.strokeStyle=p.strokeStyle;
h.globalAlpha=p.globalAlpha;h.font=p.font;h.textAlign=p.textAlign;h.textBaseline=p.textBaseline;h.arcScaleX_=p.arcScaleX_;h.arcScaleY_=p.arcScaleY_;h.lineScale_=p.lineScale_}function f(p){var h=p.indexOf("(",3),o=p.indexOf(")",h+1);h=p.substring(h+1,o).split(",");if(h.length!=4||p.charAt(3)!="a")h[3]=1;return h}function l(p,h,o){return Math.min(o,Math.max(h,p))}function m(p,h,o){o<0&&o++;o>1&&o--;return 6*o<1?p+(h-p)*6*o:2*o<1?h:3*o<2?p+(h-p)*(2/3-o)*6:p}function n(p){if(p in R)return R[p];var h,
o=1;p=String(p);if(p.charAt(0)=="#")h=p;else if(/^rgb/.test(p)){o=f(p);h="#";for(var s,x=0;x<3;x++){s=o[x].indexOf("%")!=-1?Math.floor(parseFloat(o[x])/100*255):+o[x];h+=M[l(s,0,255)]}o=+o[3]}else if(/^hsl/.test(p)){x=o=f(p);h=parseFloat(x[0])/360%360;h<0&&h++;s=l(parseFloat(x[1])/100,0,1);x=l(parseFloat(x[2])/100,0,1);if(s==0)s=x=h=x;else{var w=x<0.5?x*(1+s):x+s-x*s,A=2*x-w;s=m(A,w,h+1/3);x=m(A,w,h);h=m(A,w,h-1/3)}h="#"+M[Math.floor(s*255)]+M[Math.floor(x*255)]+M[Math.floor(h*255)];o=o[3]}else h=
p;return R[p]={color:h,alpha:o}}function t(p){this.m_=a();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=I*1;this.globalAlpha=1;this.canvas=p;var h="width:"+p.clientWidth+"px;height:"+p.clientHeight+"px;overflow:hidden;position:absolute",o=p.ownerDocument.createElement("div");o.style.cssText=h;p.appendChild(o);h=o.cloneNode(false);h.style.backgroundColor="red";h.style.filter="alpha(opacity=0)";
p.appendChild(h);this.element_=o;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function u(p,h,o,s){p.currentPath_.push({type:"bezierCurveTo",cp1x:h.x,cp1y:h.y,cp2x:o.x,cp2y:o.y,x:s.x,y:s.y});p.currentX_=s.x;p.currentY_=s.y}function v(p,h,o){p=p.m_;return{x:I*(h*p[0][0]+o*p[1][0]+p[2][0])-C,y:I*(h*p[0][1]+o*p[1][1]+p[2][1])-C}}function B(p,h,o){if(isFinite(h[0][0])&&isFinite(h[0][1])&&isFinite(h[1][0])&&isFinite(h[1][1])&&isFinite(h[2][0])&&isFinite(h[2][1])){p.m_=h;if(o)p.lineScale_=P(J(h[0][0]*
h[1][1]-h[0][1]*h[1][0]))}}function G(p){this.code=this[p];this.message=p+": DOM Exception "+this.code}var F=Math,y=F.round,K=F.sin,D=F.cos,J=F.abs,P=F.sqrt,I=10,C=I/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var H=Array.prototype.slice;r(document);F={init:function(p){p=p||document;p.createElement("canvas");p.attachEvent("onreadystatechange",q(this.init_,this,p))},init_:function(p){p=p.getElementsByTagName("canvas");for(var h=0;h<p.length;h++)this.initElement(p[h])},initElement:function(p){if(!p.getContext){p.getContext=
e;r(p.ownerDocument);p.innerHTML="";p.attachEvent("onpropertychange",b);p.attachEvent("onresize",c);var h=p.attributes;if(h.width&&h.width.specified)p.style.width=h.width.nodeValue+"px";else p.width=p.clientWidth;if(h.height&&h.height.specified)p.style.height=h.height.nodeValue+"px";else p.height=p.clientHeight}return p}};F.init();for(var M=[],z=0;z<16;z++)for(var L=0;L<16;L++)M[z*16+L]=z.toString(16)+L.toString(16);var R={},U={butt:"flat",round:"round"};z=t.prototype;z.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};z.beginPath=function(){this.currentPath_=[]};z.moveTo=function(p,h){var o=v(this,p,h);this.currentPath_.push({type:"moveTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};z.lineTo=function(p,h){var o=v(this,p,h);this.currentPath_.push({type:"lineTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};z.bezierCurveTo=function(p,h,o,s,x,w){x=v(this,x,w);p=v(this,p,h);o=v(this,o,s);u(this,p,o,x)};z.quadraticCurveTo=function(p,h,o,s){p=v(this,
p,h);o=v(this,o,s);s={x:this.currentX_+2/3*(p.x-this.currentX_),y:this.currentY_+2/3*(p.y-this.currentY_)};u(this,s,{x:s.x+(o.x-this.currentX_)/3,y:s.y+(o.y-this.currentY_)/3},o)};z.arc=function(p,h,o,s,x,w){o*=I;var A=w?"at":"wa",E=p+D(s)*o-C,N=h+K(s)*o-C;s=p+D(x)*o-C;x=h+K(x)*o-C;if(E==s&&!w)E+=0.125;p=v(this,p,h);E=v(this,E,N);s=v(this,s,x);this.currentPath_.push({type:A,x:p.x,y:p.y,radius:o,xStart:E.x,yStart:E.y,xEnd:s.x,yEnd:s.y})};z.stroke=function(p){var h=[];h.push("<g_vml_:shape",' filled="',
!!p,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',I*10,",",I*10,'"',' stroked="',!p,'"',' path="');for(var o={x:null,y:null},s={x:null,y:null},x=0;x<this.currentPath_.length;x++){var w=this.currentPath_[x];switch(w.type){case "moveTo":h.push(" m ",y(w.x),",",y(w.y));break;case "lineTo":h.push(" l ",y(w.x),",",y(w.y));break;case "close":h.push(" x ");w=null;break;case "bezierCurveTo":h.push(" c ",y(w.cp1x),",",y(w.cp1y),",",y(w.cp2x),",",y(w.cp2y),
",",y(w.x),",",y(w.y));break;case "at":case "wa":h.push(" ",w.type," ",y(w.x-this.arcScaleX_*w.radius),",",y(w.y-this.arcScaleY_*w.radius)," ",y(w.x+this.arcScaleX_*w.radius),",",y(w.y+this.arcScaleY_*w.radius)," ",y(w.xStart),",",y(w.yStart)," ",y(w.xEnd),",",y(w.yEnd))}if(w){if(o.x==null||w.x<o.x)o.x=w.x;if(s.x==null||w.x>s.x)s.x=w.x;if(o.y==null||w.y<o.y)o.y=w.y;if(s.y==null||w.y>s.y)s.y=w.y}}h.push(' ">');if(p){p=n(this.fillStyle);h.push('<g_vml_:fill color="',p.color,'" opacity="',p.alpha*this.globalAlpha,
'" />')}else{o=n(this.strokeStyle);p=o.color;o=o.alpha*this.globalAlpha;s=this.lineScale_*this.lineWidth;if(s<1)o*=s;h.push("<g_vml_:stroke",' opacity="',o,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',U[this.lineCap]||"square",'"',' weight="',s,'px"',' color="',p,'" />')}h.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",h.join(""))};z.fill=function(){this.stroke(true)};z.closePath=function(){this.currentPath_.push({type:"close"})};z.save=
function(){var p={};g(this,p);this.aStack_.push(p);this.mStack_.push(this.m_);this.m_=d(a(),this.m_)};z.restore=function(){if(this.aStack_.length){g(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};z.translate=function(p,h){B(this,d([[1,0,0],[0,1,0],[p,h,1]],this.m_),false)};z.scale=function(p,h){this.arcScaleX_*=p;this.arcScaleY_*=h;B(this,d([[p,0,0],[0,h,0],[0,0,1]],this.m_),true)};z=G.prototype=Error();z.INDEX_SIZE_ERR=1;z.DOMSTRING_SIZE_ERR=2;z.HIERARCHY_REQUEST_ERR=3;z.WRONG_DOCUMENT_ERR=
4;z.INVALID_CHARACTER_ERR=5;z.NO_DATA_ALLOWED_ERR=6;z.NO_MODIFICATION_ALLOWED_ERR=7;z.NOT_FOUND_ERR=8;z.NOT_SUPPORTED_ERR=9;z.INUSE_ATTRIBUTE_ERR=10;z.INVALID_STATE_ERR=11;z.SYNTAX_ERR=12;z.INVALID_MODIFICATION_ERR=13;z.NAMESPACE_ERR=14;z.INVALID_ACCESS_ERR=15;z.VALIDATION_ERR=16;z.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=F;CanvasRenderingContext2D=t;DOMException=G}();
$.widget||function(e,q){var r=Array.prototype.slice,b=e.cleanData;e.cleanData=function(c){for(var a=0,d;(d=c[a])!=null;a++)e(d).triggerHandler("remove");b(c)};e.widget=function(c,a,d){var g=c.split(".")[0],f;c=c.split(".")[1];f=g+"-"+c;if(!d){d=a;a=e.Widget}e.expr[":"][f]=function(m){return!!e.data(m,c)};e[g]=e[g]||{};e[g][c]=e.extend(function(m,n){if(!this._createWidget)return new e[g][c](m,n);arguments.length&&this._createWidget(m,n)},e[g][c]);var l=new a;l.options=e.extend(true,{},l.options);e.each(d,
function(m,n){if(e.isFunction(n))d[m]=function(){var t=function(v){return a.prototype[v].apply(this,r.call(arguments,1))},u=function(v,B){return a.prototype[v].apply(this,B)};return function(){var v=this._super,B=this._superApply,G;this._super=t;this._superApply=u;G=n.apply(this,arguments);this._super=v;this._superApply=B;return G}}()});e[g][c].prototype=e.extend(true,l,{namespace:g,widgetName:c,widgetEventPrefix:c,widgetBaseClass:f},d);e.widget.bridge(c,e[g][c])};e.widget.bridge=function(c,a){e.fn[c]=
function(d){var g=typeof d==="string",f=r.call(arguments,1),l=this;d=!g&&f.length?e.extend.apply(null,[true,d].concat(f)):d;g?this.each(function(){var m=e.data(this,c);if(!m)return e.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+d+"'");if(!e.isFunction(m[d])||d.charAt(0)==="_")return e.error("no such method '"+d+"' for "+c+" widget instance");var n=m[d].apply(m,f);if(n!==m&&n!==q){l=n;return false}}):this.each(function(){var m=e.data(this,c);m?m.option(d||
{})._init():a(d,this)});return l}};e.Widget=function(c,a){if(!this._createWidget)return new e[namespace][name](c,a);arguments.length&&this._createWidget(c,a)};e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(c,a){a=e(a||this.defaultElement||this)[0];this.element=e(a);this.options=e.extend(true,{},this.options,this._getCreateOptions(),c);this.bindings=e();this.hoverable=e();this.focusable=e();if(a!==this){e.data(a,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(c,a){var d=c;if(arguments.length===0)return e.extend({},this.options);if(typeof c==="string"){if(a===q)return this.options[c];d={};d[c]=a}this._setOptions(d);return this},_setOptions:function(c){var a=this;e.each(c,function(d,g){a._setOption(d,g)});return this},_setOption:function(c,a){this.options[c]=a;if(c==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!a).attr("aria-disabled",a);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(c,a){if(a){c=e(c);this.bindings=this.bindings.add(c)}else{a=c;c=this.element}var d=this;e.each(a,function(g,f){c.bind(g+"."+d.widgetName,function(){if(!(d.options.disabled===true||e(this).hasClass("ui-state-disabled")))return(typeof f===
"string"?d[f]:f).apply(d,arguments)})})},_hoverable:function(c){this.hoverable=this.hoverable.add(c);this._bind(c,{mouseenter:function(a){e(a.currentTarget).addClass("ui-state-hover")},mouseleave:function(a){e(a.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(c){this.focusable=this.focusable.add(c);this._bind(c,{focusin:function(a){e(a.currentTarget).addClass("ui-state-focus")},focusout:function(a){e(a.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(c,a,d){var g=
this.options[c];a=e.Event(a);a.type=(c===this.widgetEventPrefix?c:this.widgetEventPrefix+c).toLowerCase();d=d||{};if(a.originalEvent){c=e.event.props.length;for(var f;c;){f=e.event.props[--c];a[f]=a.originalEvent[f]}}this.element.trigger(a,d);d=e.isArray(d)?[a].concat(d):[a,d];return!(e.isFunction(g)&&g.apply(this.element[0],d)===false||a.isDefaultPrevented())}}}(jQuery);
window.JsViews||window.jQuery&&jQuery.views||function(e,q){function r(h,o,s,x,w){var A=(s=s||{viewsCount:0,ctx:n.helpers})&&s.ctx;return{jsViews:"v1.0pre",path:o||"",itemNumber:++s.viewsCount||1,viewsCount:0,tmpl:w,data:x||s.data||{},ctx:h&&h===A?A:A?F(F({},A),h):h||{},parent:s}}function b(h,o,s,x,w,A,E){return s?(x?w?"$view."+w:s:"$data."+s)+(A||""):E||o||""}function c(h){function o(O){O-=x;O&&E.push(h.substr(x,O).replace(C,"\\n"))}var s,x=0,w=[],A=[],E=A,N=[,,A];h=h.replace(M,"\\$1");h.replace(v,
function(O,S,Q,ga,ha,T,ia,ja,ka,ca){function la(Z,V,ma,da,na,oa,ea,fa,pa,qa){return W?(W=!ea,W?Z:'"'):X?(X=!fa,X?Z:'"'):da?V.replace(P,b)+da:na?Y?"":(aa=K,"\u0008"+V+":"):ma?(Y++,V.replace(P,b)+"("):pa?(Y--,")"):V?V.replace(P,b):oa?",":qa?Y?"":aa?(aa=y,"\u0008"):",":(W=ea,X=fa,'"')}var aa,ba="",Y=0,X=y,W=y;Q=Q||ga;o(ca);if(ha)n.allowCode&&E.push(["*",T.replace(H,"$1")]);else if(Q){if(Q==="else"){N=w.pop();E=N[2];S=K}T=T?(T+" ").replace(I,la).replace(z,function(Z,V){ba+=V+",";return""}):"";T=T.slice(0,
-1);s=[Q,ia?ja||"none":"",S&&[],"{"+ba+"_hash:'"+ba+"',_path:'"+T+"'}",T];if(S){w.push(N);N=s}E.push(s)}else if(ka)N=w.pop();x=ca+O.length;if(!N)throw"Expected block tag";E=N[2]});o(h.length);return a(A)}function a(h){var o,s,x=[],w=h.length,A="try{var views="+(D?"jQuery":"JsViews")+'.views,tag=views.renderTag,enc=views.encode,html=views.encoders.html,$ctx=$view && $view.ctx,result=""+\n\n';for(s=0;s<w;s++){o=h[s];if(o[0]==="*")A=A.slice(0,s?-1:-3)+";"+o[1]+(s+1<w?"result+=":"");else if(""+o===o)A+=
'"'+o+'"+';else{var E=o[0],N=o[1],O=o[2],S=o[3];o=o[4];var Q=o+'||"")+';O&&x.push(a(O));A+=E==="="?!N||N==="html"?"html("+Q:N==="none"?"("+Q:'enc("'+N+'",'+Q:'tag("'+E+'",$view,"'+(N||"")+'",'+(O?x.length:'""')+","+S+(o?",":"")+o+")+"}}h=new Function("$data, $view",A.slice(0,-1)+";return result;\n\n}catch(e){return views.err(e);}");h.nested=x;return h}function d(h){return R[h]||(R[h]="&#"+h.charCodeAt(0)+";")}function g(h){try{return f(h)}catch(o){}return h}var f,l,m,n,t,u,v,B,G,F,y=false,K=true,
D=e.jQuery,J=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,P=/^(true|false|null|[\d\.]+)|(\w+|\$(view|data|ctx|(\w+)))([\w\.]*)|((['"])(?:\\\1|.)*\7)$/g,I=/(\$?[\w\.\[\]]+)(?:(\()|\s*(===|!==|==|!=|<|>|<=|>=)\s*|\s*(\=)\s*)?|(\,\s*)|\\?(\')|\\?(\")|(\))|(\s+)/g,C=/\r?\n/g,H=/\\(['"])/g,M=/\\?(['"])/g,z=/\x08([^\x08]+)\x08/g,L=0,R={"&":"&amp;","<":"&lt;",">":"&gt;"},U=/[\x00"&'<>]/g,p=Array.prototype.slice;if(D){f=D;f.fn.extend({render:function(h,o,s,x){return u(h,this[0],o,s,x)},template:function(h,o){return f.template(h,
this[0],o)}})}else{l=e.$;e.JsViews=m=e.$=f={extend:function(h,o){for(var s in o)h[s]=o[s];return h},isArray:Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"},noConflict:function(){if(e.$===m)e.$=l;return m}}}F=f.extend;F(f,{views:n={templates:{},tags:{"if":function(){var h=this._view;h.onElse=function(o,s){for(var x=0,w=s.length;w&&!s[x++];)if(x===w)return"";h.onElse=q;return u(h.data,o.tmpl,h.ctx,h)};return h.onElse(this,arguments)},"else":function(){var h=this._view;
return h.onElse?h.onElse(this,arguments):""},each:function(){var h,o="",s=arguments,x=s.length,w=this.tmpl,A=this._view;for(h=0;h<x;h++)o+=s[h]?u(s[h],w,this.ctx||A.ctx,A,this._path,this._ctor):"";return x?o:o+u(A.data,w,A.ctx,A,this._path,this.tag)},"=":function(h){return h},"*":function(h){return h}},helpers:{not:function(h){return!h}},allowCode:y,debugMode:K,err:function(h){return n.debugMode?"<br/><b>Error:</b> <em> "+(h.message||h)+". </em>":'""'},setDelimiters:function(h,o){var s=o.charAt(0),
x=o.charAt(1);h="\\"+h.charAt(0)+"\\"+h.charAt(1);o="\\"+s+"\\"+x;v=h+"(?:(?:(\\#)?(\\w+(?=[!\\s\\"+s+"]))|(?:(\\=)|(\\*)))\\s*((?:[^\\"+s+"]|\\"+s+"(?!\\"+x+"))*?)(!(\\w*))?|(?:\\/([\\w\\$\\.\\[\\]]+)))"+o;v=RegExp(v,"g")},registerTags:B=function(h,o){var s;if(typeof h==="object")for(s in h)B(s,h[s]);else n.tags[h]=o;return this},registerHelpers:G=function(h,o){if(typeof h==="object")for(var s in h)G(s,h[s]);else n.helpers[h]=o;return this},encode:function(h,o){return o?(t[h||"html"]||t.html)(o):
""},encoders:t={none:function(h){return h},html:function(h){return String(h).replace(U,d)}},renderTag:function(h,o,s,x,w){var A,E;A=arguments;E=n.presenters;hash=w._hash;tagFn=n.tags[h];if(!tagFn)return"";x=x&&o.tmpl.nested[x-1];w.tmpl=w.tmpl||x||q;if(E&&E[h]){E=F(F({},w.ctx),w);delete E.ctx;delete E._path;delete E.tmpl;w.ctx=E;w._ctor=h+(hash?"="+hash.slice(0,-1):"");w=F(F({},tagFn),w);tagFn=n.tags.each}w._encode=s;w._view=o;return(A=tagFn.apply(w,A.length>5?p.call(A,5):[o.data]))||(A===q?"":A.toString())}},
render:u=function(h,o,s,x,w,A){var E,N,O,S,Q="";if(arguments.length===2&&h.jsViews){x=h;s=x.ctx;h=x.data}o=f.template(o);if(!o)return"";if(f.isArray(h)){S=new r(s,w,x,h);E=0;for(N=h.length;E<N;E++){O=(O=h[E])?o(O,new r(s,w,S,O,o,this)):"";Q+=n.activeViews?"<!--item--\>"+O+"<!--/item--\>":O}}else Q+=o(h,new r(s,w,x,h,o));return n.activeViews?"<!--tmpl("+(w||"")+") "+(A?"tag="+A:o._name)+"--\>"+Q+"<!--/tmpl--\>":Q},template:function(h,o){if(o){if(""+o===o)o=c(o);else if(D&&o instanceof f)o=o[0];if(o){if(D&&
o.nodeType)o=f.data(o,"tmpl")||f.data(o,"tmpl",c(o.innerHTML));n.templates[o._name=o._name||h||"_"+L++]=o}return o}return h?""+h!==h?h._name?h:f.template(null,h):n.templates[h]||f.template(null,J.test(h)?h:g(h)):null}});n.setDelimiters("{{","}}")}(window);
(function(e,q,r){var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;e.geo={_allCoordinates:function(a){a=this._flatten(a);for(var d=0,g=[];d<a.length;d++){var f=a[d].coordinates,l=f&&e.isArray(f[0]),m=l&&e.isArray(f[0][0]),n;if(!(m&&e.isArray(f[0][0][0]))){if(!m){l||(f=[f]);f=[f]}f=[f]}for(l=0;l<f.length;l++)for(m=0;m<f[l].length;m++)for(n=0;n<f[l][m].length;n++)g.push(f[l][m][n])}return g},_isGeodetic:function(a){for(;e.isArray(a);)if(a.length>1&&!e.isArray(a[0]))return a[0]>=-180&&a[0]<=
180&&a[1]>=-85&&a[1]<=85;else a=a[0];return false},center:function(a,d){var g=false;if(!d&&e.geo.proj&&this._isGeodetic(a)){g=true;a=e.geo.proj.fromGeodetic(a)}var f=[(a[0]+a[2])/2,(a[1]+a[3])/2];return g?e.geo.proj.toGeodetic(f):f},expandBy:function(a,d,g,f){var l=false;if(!f&&e.geo.proj&&this._isGeodetic(a)){l=true;a=e.geo.proj.fromGeodetic(a)}a=[a[0]-d,a[1]-g,a[2]+d,a[3]+g];return l?e.geo.proj.toGeodetic(a):a},height:function(a,d){if(!d&&e.geo.proj&&this._isGeodetic(a))a=e.geo.proj.fromGeodetic(a);
return a[3]-a[1]},_in:function(a,d){return a[0]<=d[0]&&a[1]<=d[1]&&a[2]>=d[2]&&a[3]>=d[3]},_bboxDisjoint:function(a,d){return d[0]>a[2]||d[2]<a[0]||d[1]>a[3]||d[3]<a[1]},reaspect:function(a,d,g){var f=false;if(!g&&e.geo.proj&&this._isGeodetic(a)){f=true;a=e.geo.proj.fromGeodetic(a)}var l=this.width(a,true),m=this.height(a,true);g=this.center(a,true);if(l!=0&&m!=0&&d>0){if(l/m>d){a=l/2;l=a/d}else{l=m/2;a=l*d}a=[g[0]-a,g[1]-l,g[0]+a,g[1]+l]}return f?e.geo.proj.toGeodetic(a):a},recenter:function(a,d,
g){var f=false;if(!g&&e.geo.proj){if(this._isGeodetic(a)){f=true;a=e.geo.proj.fromGeodetic(a)}if(this._isGeodetic(d))d=e.geo.proj.fromGeodetic(d)}g=(a[2]-a[0])/2;a=(a[3]-a[1])/2;a=[d[0]-g,d[1]-a,d[0]+g,d[1]+a];return f?e.geo.proj.toGeodetic(a):a},scaleBy:function(a,d,g){var f=false;if(!g&&e.geo.proj&&this._isGeodetic(a)){f=true;a=e.geo.proj.fromGeodetic(a)}g=this.center(a,true);var l=(a[2]-a[0])*d/2;a=(a[3]-a[1])*d/2;a=[g[0]-l,g[1]-a,g[0]+l,g[1]+a];return f?e.geo.proj.toGeodetic(a):a},width:function(a,
d){if(!d&&e.geo.proj&&this._isGeodetic(a))a=e.geo.proj.fromGeodetic(a);return a[2]-a[0]},bbox:function(a,d){if(a)if(a.bbox)result=!d&&e.geo.proj&&this._isGeodetic(a.bbox)?e.geo.proj.fromGeodetic(a.bbox):a.bbox;else{result=[b,b,c,c];var g=this._allCoordinates(a),f=0;if(g.length==0)return r;var l=false;if(!d&&e.geo.proj&&this._isGeodetic(g)){l=true;g=e.geo.proj.fromGeodetic(g)}for(;f<g.length;f++){result[0]=Math.min(g[f][0],result[0]);result[1]=Math.min(g[f][1],result[1]);result[2]=Math.max(g[f][0],
result[2]);result[3]=Math.max(g[f][1],result[3])}}else return r;return l?e.geo.proj.toGeodetic(result):result},centroid:function(a,d){switch(a.type){case "Point":return e.extend({},a);case "LineString":case "Polygon":var g=0,f=[0,0],l=e.merge([],a.type=="Polygon"?a.coordinates[0]:a.coordinates),m=1,n,t,u=false;if(!d&&e.geo.proj&&this._isGeodetic(l)){u=true;l=e.geo.proj.fromGeodetic(l)}for(;m<=l.length;m++){n=m%l.length;t=l[m-1][0]*l[n][1]-l[n][0]*l[m-1][1];g+=t;f[0]+=(l[m-1][0]+l[n][0])*t;f[1]+=(l[m-
1][1]+l[n][1])*t}if(g==0)if(l.length>0){f[0]=l[0][0];f[1]=l[0][1];return{type:"Point",coordinates:u?e.geo.proj.toGeodetic(f):f}}else break;g*=3;f[0]/=g;f[1]/=g;return{type:"Point",coordinates:u?e.geo.proj.toGeodetic(f):f}}return r},contains:function(a,d){if(a.type!="Polygon")return false;switch(d.type){case "Point":return this._containsPolygonPoint(a.coordinates,d.coordinates);case "LineString":return this._containsPolygonLineString(a.coordinates,d.coordinates);case "Polygon":return this._containsPolygonLineString(a.coordinates,
d.coordinates[0]);default:return false}},_containsPolygonPoint:function(a,d){if(a.length==0||a[0].length<4)return false;for(var g=0,f=a[0][0],l=1,m;l<a[0].length;l++){m=a[0][l];if(f[1]<=d[1]&&d[1]<m[1]||m[1]<=d[1]&&d[1]<f[1]&&(d[0]<f[0]||d[0]<m[0])){f=f[0]+(m[0]-f[0])*(d[1]-f[1])/(m[1]-f[1]);f>d[0]&&g++}f=m}return g%2==1},_containsPolygonLineString:function(a,d){for(var g=0;g<d.length;g++)if(!this._containsPolygonPoint(a,d[g]))return false;return true},distance:function(a,d,g){var f=!g&&e.geo.proj&&
this._isGeodetic(a.coordinates)?e.geo.proj.fromGeodetic(a.coordinates):a.coordinates;g=!g&&e.geo.proj&&this._isGeodetic(d.coordinates)?e.geo.proj.fromGeodetic(d.coordinates):d.coordinates;switch(a.type){case "Point":switch(d.type){case "Point":return this._distancePointPoint(g,f);case "LineString":return this._distanceLineStringPoint(g,f);case "Polygon":return this._containsPolygonPoint(g,f)?0:this._distanceLineStringPoint(g[0],f);default:return r}case "LineString":switch(d.type){case "Point":return this._distanceLineStringPoint(f,
g);case "LineString":return this._distanceLineStringLineString(f,g);case "Polygon":return this._containsPolygonLineString(g,f)?0:this._distanceLineStringLineString(g[0],f);default:return r}case "Polygon":switch(d.type){case "Point":return this._containsPolygonPoint(f,g)?0:this._distanceLineStringPoint(f[0],g);case "LineString":return this._containsPolygonLineString(f,g)?0:this._distanceLineStringLineString(f[0],g);case "Polygon":return this._containsPolygonLineString(f,g[0])?0:this._distanceLineStringLineString(f[0],
g[0]);default:return r}}},_distancePointPoint:function(a,d){var g=d[0]-a[0],f=d[1]-a[1];return Math.sqrt(g*g+f*f)},_distanceLineStringPoint:function(a,d){var g=b;if(a.length>0){var f=a[0],l=d[0]-f[0],m=d[1]-f[1];if(a.length==1)return Math.sqrt(l*l+m*m);else for(var n=1;n<a.length;n++){var t=a[n],u=d[0]-t[0],v=d[1]-t[1];f=this._distanceSegmentPoint(t[0]-f[0],t[1]-f[1],l,m,u,v);if(f==0)return 0;if(f<g)g=f;f=t;l=u;m=v}}return Math.sqrt(g)},_distanceSegmentPoint:function(a,d,g,f,l,m){var n=a*g+d*f;if(n<=
0)return g*g+f*f;a=a*a+d*d;if(n>=a)return l*l+m*m;return g*g+f*f-n*n/a},_distanceLineStringLineString:function(a,d){for(var g=b,f=0;f<d.length;f++)g=Math.min(g,this._distanceLineStringPoint(a,d[f]));return g},_buffer:function(a,d,g){var f=false,l=a.coordinates;if(!g&&e.geo.proj&&this._isGeodetic(a.coordinates)){f=true;l=e.geo.proj.fromGeodetic(a.coordinates)}switch(a.type){case "Point":a=[];g=0;for(var m;g<=180;g++){m=g*360/180*(Math.PI/180);a.push([l[0]+Math.cos(m)*d,l[1]+Math.sin(m)*d])}return{type:"Polygon",
coordinates:[f?e.geo.proj.toGeodetic(a):a]};default:return r}},_flatten:function(a){var d=[],g=0;switch(a.type){case "Feature":e.merge(d,this._flatten(a.geometry));break;case "FeatureCollection":for(;g<a.features.length;g++)e.merge(d,this._flatten(a.features[g].geometry));break;case "GeometryCollection":for(;g<a.geometries.length;g++)e.merge(d,this._flatten(a.geometries[g]));break;default:d[0]=a}return d},length:function(a,d){var g=0,f,l=1,m,n;switch(a.type){case "Point":return 0;case "LineString":f=
a.coordinates;break;case "Polygon":f=a.coordinates[0]}if(f){if(!d&&e.geo.proj&&this._isGeodetic(f))f=e.geo.proj.fromGeodetic(f);for(;l<f.length;l++){m=f[l][0]-f[l-1][0];n=f[l][1]-f[l-1][1];g+=Math.sqrt(m*m+n*n)}return g}},area:function(a,d){var g=0,f,l=1,m;switch(a.type){case "Point":case "LineString":return 0;case "Polygon":f=a.coordinates[0]}if(f){if(!d&&e.geo.proj&&this._isGeodetic(f))f=e.geo.proj.fromGeodetic(f);for(;l<=f.length;l++){m=l%f.length;g+=(f[l-1][0]-f[m][0])*(f[l-1][1]+f[m][1])/2}return Math.abs(g)}},
pointAlong:function(a,d,g){var f=0,l=0,m=0,n,t=[],u=1,v=false;switch(a.type){case "Point":return e.extend({},a);case "LineString":n=a.coordinates;break;case "Polygon":n=a.coordinates[0]}if(n)if(d===0)return{type:"Point",coordinates:[n[0][0],n[0][1]]};else if(d===1){u=n.length-1;return{type:"Point",coordinates:[n[u][0],n[u][1]]}}else{if(!g&&e.geo.proj&&this._isGeodetic(n)){v=true;n=e.geo.proj.fromGeodetic(n)}for(;u<n.length;u++){a=n[u][0]-n[u-1][0];g=n[u][1]-n[u-1][1];a=Math.sqrt(a*a+g*g);t.push(a);
f+=a}for(u=0;u<t.length&&m<d;u++){l=m;m+=t[u]/f}d=d-l;f=n[u-1];n=n[u];n=[f[0]+d*(n[0]-f[0]),f[1]+d*(n[1]-f[1])];return{type:"Point",coordinates:v?e.geo.proj.toGeodetic(n):n}}},_WKT:function(){function a(f){if(f&&f.length){for(var l=[],m=0;m<f.length;m++)l.push(f[m].join(" "));return"("+l+")"}else return"EMPTY"}function d(f){if(f&&f.length){for(var l=[],m=0;m<f.length;m++)l.push(a(f[m]));return"("+l+")"}else return"EMTPY"}function g(f){if(f&&f.type)switch(f.type){case "Point":return"POINT "+(f.coordinates&&
f.coordinates.length?"("+f.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+a(f.coordinates);case "Polygon":return"POLYGON "+d(f.coordinates);case "MultiPoint":return"MULTIPOINT "+a(f.coordinates);case "MultiLineString":return"MULTILINSTRING "+d(f.coordinates);case "MultiPolygon":if((f=f.coordinates)&&f.length){for(var l=[],m=0;m<f.length;m++)l.push(d(f[m]));f="("+l+")"}else f="EMPTY";return"MULTIPOLYGON "+f;case "GeometryCollection":if((f=f.geometries)&&f.length){l=[];for(m=
0;m<f.length;m++)l.push(g(f[m]));f="("+f+")"}else f="EMPTY";return"GEOMETRYCOLLECTION "+f;default:return""}else return""}return{stringify:g,parse:function(f){f=e.trim(f);var l=f.indexOf(" "),m=f.substr(l+1);switch(f.substr(0,l).toUpperCase()){case "POINT":return(f=m.match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&f.length>2?{type:"Point",coordinates:[parseFloat(f[1]),parseFloat(f[2])]}:null;case "LINESTRING":m=m.match(/\s*\((.*)\)/);f=[];var n;l=0;if(m.length>1){for(m=m[1].match(/[\d\.-]+\s+[\d\.-]+/g);l<
m.length;l++){n=m[l].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);f[l]=[parseFloat(n[1]),parseFloat(n[2])]}f={type:"LineString",coordinates:f}}else f=null;return f;case "POLYGON":m=m.match(/\s*\(\s*\((.*)\)\s*\)/);f=[];l=0;if(m.length>1){for(m=m[1].match(/[\d\.-]+\s+[\d\.-]+/g);l<m.length;l++){n=m[l].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);f[l]=[parseFloat(n[1]),parseFloat(n[2])]}f={type:"Polygon",coordinates:[f]}}else f=null;return f;default:return null}}}}(),proj:function(){return{fromGeodeticPos:function(a){if(!a)debugger;
return[6378137*a[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+a[1]*0.017453292519943295/2))]},fromGeodetic:function(a){if(!e.geo._isGeodetic(a))return a;var d=e.isArray(a[0]),g=this.fromGeodeticPos;if(!d&&a.length==4){d=g([a[0],a[1]]);a=g([a[2],a[3]]);return[d[0],d[1],a[0],a[1]]}else{var f=d&&e.isArray(a[0][0]),l=f&&e.isArray(a[0][0][0]),m=[],n,t,u;if(!l){if(!f){d||(a=[a]);a=[a]}a=[a]}for(n=0;n<a.length;n++){m[n]=[];for(t=0;t<a[n].length;t++){m[n][t]=[];for(u=0;u<a[n][t].length;u++)m[n][t][u]=
g(a[n][t][u])}}return l?m:f?m[0]:d?m[0][0]:m[0][0][0]}},toGeodeticPos:function(a){return[a[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(a[1]/6378137)))*57.29577951308232]},toGeodetic:function(a){if(e.geo._isGeodetic(a))return a;var d=e.isArray(a[0]),g=this.toGeodeticPos;if(!d&&a.length==4){d=g([a[0],a[1]]);a=g([a[2],a[3]]);return[d[0],d[1],a[0],a[1]]}else{var f=d&&e.isArray(a[0][0]),l=f&&e.isArray(a[0][0][0]),m=[];if(!l){if(!f){d||(a=[a]);a=[a]}a=[a]}for(i=0;i<a.length;i++){m[i]=
[];for(j=0;j<a[i].length;j++){m[i][j]=[];for(k=0;k<a[i][j].length;k++)m[i][j][k]=g(a[i][j][k])}}return l?m:f?m[0]:d?m[0][0]:m[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(e,q){var r=function(){for(var b=5,c=document.createElement("div"),a=c.all||[];c.innerHTML="<!--[if gt IE "+ ++b+"]><br><![endif]--\>",a[0];);return b>6?b:!b}();e.widget("geo.geographics",{_$elem:q,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:q,_context:q,_$labelsContainer:q,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=this.element;this._options=
this.options;this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._$elem.addClass("geo-graphics");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}var b="width:"+this._width+"px;height:"+this._height+"px;",c='width="'+this._width+'" height="'+this._height+
'"';if(document.createElement("canvas").getContext){this._$elem.append("<canvas "+c+' style="position:absolute;left:0;top:0;margin:0;padding:0;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d")}else if(r<=8){this._trueCanvas=false;this._$elem.append("<div "+c+' style="position:absolute;left:0;top:0;margin:0;padding:0;'+b+'"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");
this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}this._$elem.append('<div class="geo-labels-container" style="position:absolute;left:0;top:0;margin:0;padding:0;'+b+'"></div>');this._$labelsContainer=this._$elem.children(":last")},_setOption:function(b,c){if(b=="style")c=e.extend({},this._options.style,c);e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("");this._$elem.removeClass("geo-graphics")},
clear:function(){this._context.clearRect(0,0,this._width,this._height);this._$labelsContainer.html("")},drawArc:function(b,c,a,d){d=this._getGraphicStyle(d);if(d.visibility!="hidden"&&d.opacity>0&&d.widthValue>0&&d.heightValue>0){var g=Math.min(d.widthValue,d.heightValue)/2;c=c*Math.PI/180;a=a*Math.PI/180;this._context.save();this._context.translate(b[0],b[1]);d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue);this._context.beginPath();
this._context.arc(0,0,g,c,a,false);this._trueCanvas&&this._context.restore();if(d.doFill){this._context.fillStyle=d.fill;this._context.globalAlpha=d.opacity*d.fillOpacity;this._context.fill()}if(d.doStroke){this._context.lineJoin="round";this._context.lineWidth=d.strokeWidthValue;this._context.strokeStyle=d.stroke;this._context.globalAlpha=d.opacity*d.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(b,c){c=this._getGraphicStyle(c);if(c.widthValue==
c.heightValue&&c.heightValue==c.borderRadiusValue)this.drawArc(b,0,360,c);else if(c.visibility!="hidden"&&c.opacity>0){c.borderRadiusValue=Math.min(Math.min(c.widthValue,c.heightValue)/2,c.borderRadiusValue);b[0]-=c.widthValue/2;b[1]-=c.heightValue/2;this._context.beginPath();this._context.moveTo(b[0]+c.borderRadiusValue,b[1]);this._context.lineTo(b[0]+c.widthValue-c.borderRadiusValue,b[1]);this._context.quadraticCurveTo(b[0]+c.widthValue,b[1],b[0]+c.widthValue,b[1]+c.borderRadiusValue);this._context.lineTo(b[0]+
c.widthValue,b[1]+c.heightValue-c.borderRadiusValue);this._context.quadraticCurveTo(b[0]+c.widthValue,b[1]+c.heightValue,b[0]+c.widthValue-c.borderRadiusValue,b[1]+c.heightValue);this._context.lineTo(b[0]+c.borderRadiusValue,b[1]+c.heightValue);this._context.quadraticCurveTo(b[0],b[1]+c.heightValue,b[0],b[1]+c.heightValue-c.borderRadiusValue);this._context.lineTo(b[0],b[1]+c.borderRadiusValue);this._context.quadraticCurveTo(b[0],b[1],b[0]+c.borderRadiusValue,b[1]);this._context.closePath();if(c.doFill){this._context.fillStyle=
c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin="round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}}},drawLineString:function(b,c){this._drawLines([b],false,c)},drawPolygon:function(b,c){this._drawLines(b,true,c)},drawBbox:function(b,c){this._drawLines([[[b[0],b[1]],[b[0],b[3]],[b[2],b[3]],[b[2],b[1]],[b[0],b[1]]]],true,c)},
drawLabel:function(b,c){this._$labelsContainer.append('<div class="geo-label" style="position:absolute; left:'+b[0]+"px; top:"+b[1]+'px;">'+c+"</div>")},resize:function(){this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(this._trueCanvas){this._$canvas[0].width=this._width;this._$canvas[0].height=this._height}this._$labelsContainer.css({width:this._width,
height:this._height})},_getGraphicStyle:function(b){function c(a){a=parseInt(a);return+a+""===a?+a:a}b=e.extend({},this._options.style,b);b.borderRadiusValue=c(b.borderRadius);b.fill=b.fill||b.color;b.doFill=b.fill&&b.fillOpacity>0;b.stroke=b.stroke||b.color;b.strokeWidthValue=c(b.strokeWidth);b.doStroke=b.stroke&&b.strokeOpacity>0&&b.strokeWidthValue>0;b.widthValue=c(b.width);b.heightValue=c(b.height);return b},_drawLines:function(b,c,a){if(!(!b||!b.length||b[0].length<2)){a=this._getGraphicStyle(a);
var d,g;if(a.visibility!="hidden"&&a.opacity>0){this._context.beginPath();this._context.moveTo(b[0][0][0],b[0][0][1]);for(d=0;d<b.length;d++)for(g=0;g<b[d].length;g++)this._context.lineTo(b[d][g][0],b[d][g][1]);c&&this._context.closePath();if(c&&a.doFill){this._context.fillStyle=a.fill;this._context.globalAlpha=a.opacity*a.fillOpacity;this._context.fill()}if(a.doStroke){this._context.lineCap=this._context.lineJoin="round";this._context.lineWidth=a.strokeWidthValue;this._context.strokeStyle=a.stroke;
this._context.globalAlpha=a.opacity*a.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(e,q){var r=function(){for(var b=5,c=document.createElement("div"),a=c.all||[];c.innerHTML="<!--[if gt IE "+ ++b+"]><br><![endif]--\>",a[0];);return b>6?b:!b}();e.widget("geo.geomap",{_$elem:q,_map:q,_created:false,_contentBounds:{},_$resizeContainer:q,_$eventTarget:q,_$contentFrame:q,_$existingChildren:q,_$attrList:q,_$servicesContainer:q,_$panContainer:q,_$shapesContainer:q,_$drawContainer:q,_$measureContainer:q,_$measureLabel:q,_dpi:96,_currentServices:[],_center:q,_pixelSize:q,_centerMax:q,
_pixelSizeMax:q,_userGeodetic:true,_wheelTimeout:null,_wheelLevel:0,_zoomFactor:2,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:q,_inOp:q,_toolPan:q,_shiftZoom:q,_anchor:q,_current:q,_downDate:q,_moveDate:q,_clickDate:q,_lastMove:q,_lastDrag:q,_windowHandler:null,_resizeTimeout:null,_panning:q,_velocity:q,_friction:q,_supportTouch:q,_softDblClick:q,_isTap:q,_isDbltap:q,_isMultiTouch:q,_multiTouchAnchor:q,_multiTouchAnchorBbox:q,_multiTouchCurrentBbox:q,_drawTimeout:null,_drawPixels:[],
_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:e.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",
zoom:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{=length.toFixed( 2 )}} m",area:"{{=area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:true,scroll:"default",services:[{"class":"osm",type:"tiled",src:function(b){return"http://tile.openstreetmap.org/"+b.zoom+"/"+b.tile.column+"/"+b.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,
tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},axisLayout:"map",zoom:0,pixelSize:0}),_createWidget:function(b,c){this._$elem=e(c);if(this._$elem.is(".geo-service")){var a=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+a.css("width")+"; height:"+a.css("height")+'; margin:0; padding:0;"></div>');this._$shapesContainer=this._$elem.children(":last")}else{this._$elem.addClass("geo-map");
this._initOptions=b||{};this._forcePosition(this._$elem);this._$elem.css("text-align","left");a=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._createChildren();this._center=this._centerMax=[0,0];this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=false;this._anchor=
[0,0];this._current=[0,0];this._lastMove=[0,0];this._lastDrag=[0,0];this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0;this._drawPixels=[];this._drawCoords=[]}this._graphicShapes=[];e.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){this._options=this.options;if(this._$elem.is(".geo-service")){this._map=this._$elem.data("geoMap");this._$shapesContainer.geographics();this._options.shapeStyle=this._$shapesContainer.geographics("option",
"style")}else{this._map=this;this._softDblClick=(this._supportTouch="ontouchend"in document)||r==7;var b=this,c=this._supportTouch?"touchstart":"mousedown",a=this._supportTouch?"touchend touchcancel":"mouseup",d=this._supportTouch?"touchmove":"mousemove";e(document).keydown(e.proxy(this._document_keydown,this));this._$eventTarget.dblclick(e.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(c,e.proxy(this._eventTarget_touchstart,this));c=this._$eventTarget[0].setCapture?this._$eventTarget:
e(document);c.bind(d,e.proxy(this._dragTarget_touchmove,this));c.bind(a,e.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(e.proxy(this._eventTarget_mousewheel,this));this._windowHandler=function(){b._resizeTimeout&&clearTimeout(b._resizeTimeout);b._resizeTimeout=setTimeout(function(){b._created&&b._$elem.geomap("resize")},500)};e(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option",
"style");this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}});this._options.shapeStyle=this._$shapesContainer.geographics("option","style");if(this._initOptions){this._initOptions.tilingScheme&&this._setOption("tilingScheme",this._initOptions.tilingScheme,false);if(this._initOptions.services)this._options.services=e.merge([],this._initOptions.services);this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",
this._initOptions.center,false);this._initOptions.zoom!==q&&this._setZoom(this._initOptions.zoom,false,false)}e.template("geoMeasureLength",this._options.measureLabels.length);e.template("geoMeasureArea",this._options.measureLabels.area);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},_setOption:function(b,c,a){if(b!="pixelSize"){a=a===q||a;this._$elem.is(".geo-map")&&this._panFinalize();switch(b){case "bbox":if(this._userGeodetic=
e.geo.proj&&e.geo._isGeodetic(c))c=e.geo.proj.fromGeodetic(c);this._setBbox(c,false,a);c=this._getBbox();break;case "center":if(this._userGeodetic=e.geo.proj&&e.geo._isGeodetic(c))c=e.geo.proj.fromGeodetic(c);this._setCenterAndSize(c,this._pixelSize,false,a);break;case "measureLabels":c=e.extend(this._options.measureLabels,c);e.template("geoMeasureLength",c.length);e.template("geoMeasureArea",c.area);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option","style",
c);c=this._$drawContainer.geographics("option","style")}break;case "shapeStyle":if(this._$shapesContainer){this._$shapesContainer.geographics("option","style",c);c=this._$shapesContainer.geographics("option","style")}break;case "mode":this._$drawContainer.geographics("clear");this._$eventTarget.css("cursor",this._options.cursors[c]);break;case "zoom":this._setZoom(c,false,a)}e.Widget.prototype._setOption.apply(this,arguments);switch(b){case "bbox":case "center":if(this._userGeodetic){this._options.bbox=
e.geo.proj.toGeodetic(this._options.bbox);this._options.center=e.geo.proj.toGeodetic(this._center)}break;case "tilingScheme":if(c!=null){this._pixelSizeMax=this._getPixelSize(0);this._centerMax=[c.origin[0]+this._pixelSizeMax*c.tileWidth/2,c.origin[1]+this._pixelSizeMax*c.tileHeight/2]}break;case "bboxMax":this._pixelSizeMax=this._getPixelSize(0);this._centerMax=e.geo.proj&&e.geo._isGeodetic(c)?e.geo.center(e.geo.proj.fromGeodetic(c)):e.geo.center(c);break;case "services":this._createServices();a&&
this._refresh();break;case "shapeStyle":if(a){this._$shapesContainer.geographics("clear");this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}}}},destroy:function(){if(this._$elem.is(".geo-service")){this._$shapesContainer.geographics("destroy");this._$shapesContainer=q}else{this._created=false;e(window).unbind("resize",this._windowHandler);for(var b=0;b<this._currentServices.length;b++){this._currentServices[b].serviceContainer.geomap("destroy");
e.geo._serviceTypes[this._currentServices[b].type].destroy(this,this._$servicesContainer,this._currentServices[b])}this._$shapesContainer.geographics("destroy");this._$shapesContainer=q;this._$drawContainer.geographics("destroy");this._$drawContainer=q;this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeClass("geo-map")}e.Widget.prototype.destroy.apply(this,arguments)},toMap:function(b){b=this._toMap(b);return this._userGeodetic?e.geo.proj.toGeodetic(b):
b},toPixel:function(b,c,a){return this._toPixel(e.geo.proj?e.geo.proj.fromGeodetic(b):b,c,a)},opacity:function(b,c){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",b,this._$elem);else if(b>=0||b<=1)for(var a=0;a<this._currentServices.length;a++){var d=this._currentServices[a];if(!c||d.serviceContainer[0]==c[0]){d.style.opacity=b;e.geo._serviceTypes[d.type].opacity(this,d)}}},toggle:function(b,c){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",
b,this._$elem);else for(var a=0;a<this._currentServices.length;a++){var d=this._currentServices[a];if(!c||d.serviceContainer[0]==c[0]){if(b===q)b=d.style.visibility!=="visible";d.style.visibility=b?"visible":"hidden";d.serviceContainer.toggle(b);b&&e.geo._serviceTypes[d.type].refresh(this,d)}}},zoom:function(b){b!=null&&this._setZoom(this._options.zoom+b,false,true)},refresh:function(){this._refresh()},resize:function(){var b=this._findMapSize(),c=b.width/2-this._contentBounds.width/2,a=b.height/
2-this._contentBounds.height/2,d;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:b.width,height:b.height};this._$resizeContainer.css({width:b.width,height:b.height});for(d=0;d<this._currentServices.length;d++)e.geo._serviceTypes[this._currentServices[d].type].resize(this,this._currentServices[d]);this._$elem.find(".geo-graphics").css({width:b.width,height:b.height}).geographics("resize");for(d=0;d<this._drawPixels.length;d++){this._drawPixels[d][0]+=
c;this._drawPixels[d][1]+=a}this._setCenterAndSize(this._center,this._pixelSize,false,true)},append:function(b){if(b&&e.isPlainObject(b)){var c,a,d,g,f,l;c=b.type=="FeatureCollection"?b.features:e.isArray(b)?b:[b];for(d=1;d<arguments.length;d++){a=arguments[d];if(typeof a==="object")g=a;else if(typeof a==="number"||typeof a==="string")f=a;else if(typeof a==="boolean")l=a}for(d=0;d<c.length;d++){if(c[d].type!="Point"){a=e.geo.bbox(c[d]);if(e.geo.proj&&e.geo._isGeodetic(a))a=e.geo.proj.fromGeodetic(a);
e.data(c[d],"geoBbox",a)}this._graphicShapes.push({shape:c[d],style:g,label:f})}if(l===q||l)this._refresh()}},empty:function(b){for(var c=0;c<this._graphicShapes.length;c++)e.removeData(this._graphicShapes[c].shape,"geoBbox");this._graphicShapes=[];if(b===q||b)this._refresh()},find:function(b,c){var a=e.isPlainObject(b);a&&this._map.toPixel(b.coordinates);for(var d=this._map._pixelSize*c,g=[],f,l,m,n=0;n<this._graphicShapes.length;n++){f=this._graphicShapes[n];if(a)if(f.shape.type=="Point")e.geo.distance(f.shape,
b)<=d&&g.push(f.shape);else{l=e.data(f.shape,"geoBbox");l={type:"Polygon",coordinates:[[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]],[l[0],l[1]]]]};m={type:"Point",coordinates:e.geo.proj&&e.geo._isGeodetic(b.coordinates)?e.geo.proj.fromGeodetic(b.coordinates):b.coordinates};if(e.geo.distance(l,m,true)<=d){l=e.geo._flatten(f.shape);for(m=0;m<l.length;m++)if(e.geo.distance(l[m],b)<=d){g.push(f.shape);break}}}else g.push(f.shape)}this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){g=
e.merge(g,e(this).geomap("find",b,c))});return g},remove:function(b,c){for(var a=0;a<this._graphicShapes.length;a++)if(this._graphicShapes[a].shape==b){e.removeData(b,"geoBbox");var d=this._graphicShapes.slice(a+1);this._graphicShapes.length=a;this._graphicShapes.push.apply(this._graphicShapes,d);break}if(c===q||c)this._refresh()},_getBbox:function(b,c){b=b||this._center;c=c||this._pixelSize;var a=this._contentBounds.width/2*c,d=this._contentBounds.height/2*c;return[b[0]-a,b[1]-d,b[0]+a,b[1]+d]},
_setBbox:function(b,c,a){var d=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];b=Math.max(e.geo.width(b,true)/this._contentBounds.width,e.geo.height(b,true)/this._contentBounds.height);if(this._options.tilingScheme)b=this._getPixelSize(this._getZoom(d,b));else if(this._getZoom(d,b)<0)b=this._pixelSizeMax;this._setCenterAndSize(d,b,c,a)},_getBboxMax:function(){var b=this._contentBounds.width/2*this._pixelSizeMax,c=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-b,this._centerMax[1]-
c,this._centerMax[0]+b,this._centerMax[1]+c]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(b,c){b=b||this._center;c=c||this._pixelSize;var a=this._options.tilingScheme;if(a)if(a.pixelSizes!=null){for(var d=Math.floor(c*1E3),g=a.pixelSizes.length-1;g>=0;g--)if(Math.floor(a.pixelSizes[g]*1E3)>=d)return g;return 0}else return Math.max(Math.round(Math.log(a.basePixelSize/
c)/Math.log(2)),0);else{d=this._contentBounds.width/this._contentBounds.height;a=e.geo.reaspect(this._getBbox(b,c),d,true);d=e.geo.reaspect(this._getBboxMax(),d,true);return Math.max(Math.round(Math.log(e.geo.width(d,true)/e.geo.width(a,true))/Math.log(this._zoomFactor)),0)}},_setZoom:function(b,c,a){b=Math.max(b,0);this._setCenterAndSize(this._center,this._getPixelSize(b),c,a)},_createChildren:function(){this._$existingChildren=this._$elem.children().detach();this._forcePosition(this._$existingChildren);
this._$existingChildren.css("-moz-user-select","none");var b="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+b+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>');this._$eventTarget=this._$contentFrame=
this._$elem.children(":first");this._$contentFrame.append('<div class="geo-services-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>');
this._$attrList=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-draw-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$drawContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-measure-container" style="position:absolute; left:0; top:0;'+b+'"><div class="geo-measure-label" style="position:absolute; left:0; top:0;; display: none;"></div></div>');this._$measureContainer=this._$contentFrame.children(":last");
this._$measureLabel=this._$measureContainer.children();this._$panContainer=e([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]);this._$resizeContainer=e([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]);this._$contentFrame.append(this._$existingChildren);e("#geo-measure-style").length||e("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+
(r?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>")},_createServices:function(){var b,c;for(c=0;c<this._currentServices.length;c++){this._currentServices[c].serviceContainer.geomap("destroy");e.geo._serviceTypes[this._currentServices[c].type].destroy(this,this._$servicesContainer,this._currentServices[c])}this._currentServices=[];this._$servicesContainer.html("");
this._$attrList.html("");for(c=0;c<this._options.services.length;c++){b=this._currentServices[c]=e.extend({},this._options.services[c]);b.style=e.extend({visibility:"visible",opacity:1},b.style);this._$servicesContainer.append("<div "+(b.id?' id="'+b.id+'"':"")+('class="geo-service '+(b["class"]?b["class"]:"")+'"')+' style="position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+(b.style.visibility==="visible"?"block":"none")+';"></div>');serviceContainer=this._$servicesContainer.children(":last");
this._currentServices[c].serviceContainer=serviceContainer;e.geo._serviceTypes[b.type].create(this,serviceContainer,b,c);serviceContainer.data("geoMap",this).geomap();b.attr&&this._$attrList.append("<li>"+b.attr+"</li>")}this._$attrList.find("a").css({position:"relative",zIndex:100})},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var b=this._options.mode,c=this._drawPixels,a=this._drawCoords,d,g;switch(b){case "measureLength":b="drawLineString";
g={type:"LineString",coordinates:a};d=e.render({length:e.geo.length(g,true)},"geoMeasureLength");g=e.merge([],c[c.length-1]);break;case "measureArea":b="drawPolygon";g={type:"Polygon",coordinates:[e.merge([],a)]};g.coordinates[0].push(a[0]);d=e.render({area:e.geo.area(g,true)},"geoMeasureArea");g=e.merge([],c[c.length-1]);c=[c];break;case "drawPolygon":c=[c]}this._$drawContainer.geographics(b,c);if(d){this._$measureLabel.html(d);b=this._contentBounds.width-(this._$measureLabel.outerWidth(true)+g[0]);
c=this._contentBounds.height-(this._$measureLabel.outerHeight(true)+g[1]);if(b<0)g[0]+=b;if(c<0)g[1]+=c;this._$measureLabel.css({left:g[0],top:g[1]}).show()}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear");this._$measureLabel.hide()},_refreshShapes:function(b,c,a,d,g,f){var l,m,n,t,u,v,B,G=this._map._getBbox(g,f);for(l=0;l<c.length;l++){n=c[l].shape||c[l];n=n.geometry||n;m=e.data(n,"geoBbox");if(!(m&&e.geo._bboxDisjoint(G,m))){t=e.isArray(a)?
a[l].style:a;u=e.isArray(d)?d[l].label:d;v=u!==q;B=q;switch(n.type){case "Point":B=this._map.toPixel(n.coordinates,g,f);this._$shapesContainer.geographics("drawPoint",B,t);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(n.coordinates,g,f),t);if(v)B=this._map.toPixel(e.geo.pointAlong(n,0.5).coordinates,g,f);break;case "Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(n.coordinates,g,f),t);if(v)B=this._map.toPixel(e.geo.centroid(n).coordinates,
g,f);break;case "MultiPoint":for(m=0;m<n.coordinates.length;m++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(n.coordinates[m],g,f),t);if(v)B=this._map.toPixel(e.geo.centroid(n).coordinates,g,f);break;case "MultiLineString":for(m=0;m<n.coordinates.length;m++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(n.coordinates[m],g,f),t);if(v)B=this._map.toPixel(e.geo.centroid(n).coordinates,g,f);break;case "MultiPolygon":for(m=0;m<n.coordinates.length;m++)this._$shapesContainer.geographics("drawPolygon",
this._map.toPixel(n.coordinates[m],g,f),t);if(v)B=this._map.toPixel(e.geo.centroid(n).coordinates,g,f);break;case "GeometryCollection":this._refreshShapes(b,n.geometries,t,u,g,f)}v&&B&&this._$shapesContainer.geographics("drawLabel",B,u)}}},_findMapSize:function(){for(var b={width:0,height:0},c=this._$elem;c.size()&&!(b.width>0&&b.height>0);){b={width:c.width(),height:c.height()};if(b.width<=0||b.height<=0)b={width:parseInt(c.css("width")),height:parseInt(c.css("height"))};c=c.parent()}return b},_forcePosition:function(b){var c=
b.css("position");c!="relative"&&c!="absolute"&&c!="fixed"&&b.css("position","relative")},_getPixelSize:function(b){var c=this._options.tilingScheme;if(c!=null){if(b===0)return c.pixelSizes!=null?c.pixelSizes[0]:c.basePixelSize;b=Math.round(b);b=Math.max(b,0);b=Math.min(b,(c.pixelSizes!=null?c.pixelSizes.length:c.levels)-1);return c.pixelSizes!=null?c.pixelSizes[b]:c.basePixelSize/Math.pow(2,b)}else{b=e.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,b),true);return Math.max(e.geo.width(b,
true)/this._contentBounds.width,e.geo.height(b,true)/this._contentBounds.height)}},_getZoomCenterAndSize:function(b,c,a){c=Math.pow(a?this._fullZoomFactor:this._partialZoomFactor,-c);if(this._options.tilingScheme){c=this._getZoom(this._center,this._pixelSize*c);c=this._getPixelSize(c)}else{c=this._pixelSize*c;if(this._getZoom(this._center,c)<0)c=this._pixelSizeMax}a=c/this._pixelSize;b=this._toMap(b);a=[(this._center[0]-b[0])*a,(this._center[1]-b[1])*a];return{pixelSize:c,center:[b[0]+a[0],b[1]+a[1]]}},
_mouseWheelFinish:function(){this._wheelTimeout=null;if(this._wheelLevel!=0){var b=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=null);this._setCenterAndSize(b.center,b.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*
this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(e.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var b=-(this._current[0]-this._anchor[0])*this._pixelSize,c=(this._options.axisLayout==="image"?-1:1)*(this._current[1]-this._anchor[1])*this._pixelSize;this._$panContainer.css({left:0,
top:0});this._$servicesContainer.find(".geo-shapes-container").css({left:0,top:0});this._setCenterAndSize([this._center[0]+b,this._center[1]+c],this._pixelSize,true,true);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._inOp=false;this._anchor=this._current;this._mouseDown=this._toolPan=this._panning=false}},_panMove:function(){if(this._options.pannable){var b=this._current[0]-this._lastDrag[0],c=this._current[1]-this._lastDrag[1],a=0,d,g;if(this._toolPan||b>3||b<-3||
c>3||c<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",this._options.cursors.pan)}if(this._mouseDown)this._velocity=[b,c];if(b!=0||c!=0){this._panning=true;this._lastDrag=this._current;g={left:function(f,l){return parseInt(l)+b},top:function(f,l){return parseInt(l)+c}};for(a=0;a<this._currentServices.length;a++){d=this._currentServices[a];e.geo._serviceTypes[d.type].interactivePan(this,d,b,c);d.serviceContainer.find(".geo-shapes-container").css(g)}this._$panContainer.css(g)}}}},
_refresh:function(){var b,c=0;if(this._$elem.is(".geo-map"))for(;c<this._currentServices.length;c++){b=this._currentServices[c];if(!this._mouseDown&&e.geo._serviceTypes[b.type]!==null){e.geo._serviceTypes[b.type].refresh(this,b);b.serviceContainer.geomap("refresh")}}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(b,
c,a,d){if(!(!e.isArray(b)||b.length!=2||typeof b[0]!=="number"||typeof b[1]!=="number")){if(this._pixelSize!=c){this._$elem.find(".geo-shapes-container").geographics("clear");for(var g=0;g<this._currentServices.length;g++){var f=this._currentServices[g];e.geo._serviceTypes[f.type].interactiveScale(this,f,b,c)}}this._center=e.merge([],b);this._options.pixelSize=this._pixelSize=c;if(this._userGeodetic){this._options.bbox=e.geo.proj.toGeodetic(this._getBbox());this._options.center=e.geo.proj.toGeodetic(this._center)}else{this._options.bbox=
this._getBbox();this._options.center=e.merge([],b)}this._options.zoom=this._getZoom();if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);a&&this._trigger("bboxchange",window.event,{bbox:e.merge([],this._options.bbox)});if(d){this._refresh();this._refreshDrawing()}}},_toMap:function(b,c,a){c=c||this._center;a=a||this._pixelSize;var d=e.isArray(b[0]),g=d&&e.isArray(b[0][0]),f=g&&e.isArray(b[0][0][0]),l=this._contentBounds.width,m=this._contentBounds.height,n=l/2*a;a=m/2*a;
c=[c[0]-n,c[1]-a,c[0]+n,c[1]+a];l=e.geo.width(c,true)/l;m=e.geo.height(c,true)/m;a=this._options.axisLayout==="image";var t=[],u,v,B;if(!f){if(!g){d||(b=[b]);b=[b]}b=[b]}for(u=0;u<b.length;u++){t[u]=[];for(v=0;v<b[u].length;v++){t[u][v]=[];for(B=0;B<b[u][v].length;B++){n=b[u][v][B][1]*m;t[u][v][B]=[c[0]+b[u][v][B][0]*l,a?c[1]+n:c[3]-n]}}}return f?t:g?t[0]:d?t[0][0]:t[0][0][0]},_toPixel:function(b,c,a){c=c||this._center;a=a||this._pixelSize;var d=e.isArray(b[0]),g=d&&e.isArray(b[0][0]),f=g&&e.isArray(b[0][0][0]),
l=this._contentBounds.width,m=this._contentBounds.height,n=l/2*a;a=m/2*a;c=[c[0]-n,c[1]-a,c[0]+n,c[1]+a];var t=e.geo.width(c,true);a=e.geo.height(c,true);n=this._options.axisLayout==="image";l=l/t;m=m/a;a=[];var u,v;if(!f){if(!g){d||(b=[b]);b=[b]}b=[b]}for(t=0;t<b.length;t++){a[t]=[];for(u=0;u<b[t].length;u++){a[t][u]=[];for(v=0;v<b[t][u].length;v++)a[t][u][v]=[Math.round((b[t][u][v][0]-c[0])*l),Math.round((n?b[t][u][v][1]-c[1]:c[3]-b[t][u][v][1])*m)]}}return f?a:g?a[0]:d?a[0][0]:a[0][0][0]},_zoomTo:function(b,
c,a,d){c=c<0?0:c;c=this._getPixelSize(c);this._setCenterAndSize(b,c,a,d)},_document_keydown:function(b){var c=this._drawCoords.length;if(c>0&&b.which==27)if(c<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[c-2]=e.merge([],this._drawCoords[c-1]);this._drawPixels[c-2]=e.merge([],this._drawPixels[c-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(b){this._trigger("dblclick",b,{type:"Point",coordinates:this.toMap(this._current)});
if(!b.isDefaultPrevented()){b=this._getZoomCenterAndSize(this._current,1,true);this._setCenterAndSize(b.center,b.pixelSize,true,true)}},_eventTarget_dblclick:function(b){if(this._options.mode!=="static"){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}e(b.currentTarget).offset();switch(this._options.mode){case "drawLineString":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;
this._trigger("shape",b,{type:"LineString",coordinates:this._userGeodetic?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;case "drawPolygon":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var c=this._drawCoords.length-1;if(c>2){this._drawCoords[c]=e.merge([],this._drawCoords[0]);this._trigger("shape",b,{type:"Polygon",coordinates:[this._userGeodetic?
e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;case "measureLength":case "measureArea":this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(b)}this._inOp=false}},_eventTarget_touchstart:function(b){if(this._options.mode!=="static")if(!(!this._supportTouch&&b.which!=1))if(this._options.mode!=="static"){this._panFinalize();this._mouseWheelFinish();var c=e(b.currentTarget).offset(),a=b.originalEvent.changedTouches;
if(this._supportTouch){this._multiTouchAnchor=e.merge([],a);if(this._isMultiTouch=this._multiTouchAnchor.length>1){this._multiTouchCurrentBbox=[a[0].pageX-c.left,a[0].pageY-c.top,a[1].pageX-c.left,a[1].pageY-c.top];this._multiTouchAnchorBbox=e.merge([],this._multiTouchCurrentBbox);this._current=e.geo.center(this._multiTouchCurrentBbox,true)}else{this._multiTouchCurrentBbox=[a[0].pageX-c.left,a[0].pageY-c.top,NaN,NaN];this._current=[a[0].pageX-c.left,a[0].pageY-c.top]}}else this._current=[b.pageX-
c.left,b.pageY-c.top];if(this._softDblClick){c=e.now();if(c-this._downDate<750){if(this._isTap){a=this._current[0]-this._anchor[0];var d=this._current[1]-this._anchor[1];if(Math.sqrt(a*a+d*d)>10)this._isTap=false;else this._current=this._anchor}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=c}this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&b.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else if(!this._isMultiTouch&&
this._options.pannable){this._inOp=true;switch(this._options.mode){case "zoom":break;default:this._lastDrag=this._current;b.currentTarget.setCapture&&b.currentTarget.setCapture()}}b.preventDefault();return false}},_dragTarget_touchmove:function(b){if(this._options.mode!=="static"){var c=this._$eventTarget.offset(),a=this._drawCoords.length,d=b.originalEvent.changedTouches,g;g=0;if(this._supportTouch){if(!this._isMultiTouch&&d[0].identifier!==this._multiTouchAnchor[0].identifier){this._mouseDown=false;
this._dragTarget_touchstop(b);this._isMultiTouch=true;this._multiTouchAnchor.push(d[0]);this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-c.left,this._multiTouchAnchor[1].pageY-c.top];this._multiTouchAnchorBbox=e.merge([],this._multiTouchCurrentBbox);this._mouseDown=true;this._anchor=this._current=e.geo.center(this._multiTouchCurrentBbox,true);return false}if(this._isMultiTouch){for(;g<d.length;g++)if(d[g].identifier===this._multiTouchAnchor[0].identifier){this._multiTouchCurrentBbox[0]=
d[g].pageX-c.left;this._multiTouchCurrentBbox[1]=d[g].pageY-c.top}else if(d[g].identifier===this._multiTouchAnchor[1].identifier){this._multiTouchCurrentBbox[2]=d[g].pageX-c.left;this._multiTouchCurrentBbox[3]=d[g].pageY-c.top}e.geo.center(this._multiTouchCurrentBbox,true);g=this._multiTouchCurrentBbox[2]-this._multiTouchCurrentBbox[0];c=this._multiTouchAnchorBbox[2]-this._multiTouchAnchorBbox[0];this._wheelLevel=Math.abs(Math.floor((1-g/c)*10));if(Math.abs(g)<Math.abs(c))this._wheelLevel=-this._wheelLevel;
d=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,false);this._$elem.find(".geo-shapes-container").geographics("clear");for(g=0;g<this._currentServices.length;g++){c=this._currentServices[g];e.geo._serviceTypes[c.type].interactiveScale(this,c,d.center,d.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,d.center,d.pixelSize);if(this._drawCoords.length>0){this._drawPixels=
this._toPixel(this._drawCoords,d.center,d.pixelSize);this._refreshDrawing()}g=e.geo.center(this._multiTouchCurrentBbox,true)}else g=[b.originalEvent.changedTouches[0].pageX-c.left,b.originalEvent.changedTouches[0].pageY-c.top]}else g=[b.pageX-c.left,b.pageY-c.top];if(g[0]===this._lastMove[0]&&g[1]===this._lastMove[1])if(this._inOp){b.preventDefault();return false}if(this._softDblClick)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=g;this._moveDate=e.now()}if(this._isMultiTouch){b.preventDefault();
return false}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],g[0],g[1]])}else this._trigger("move",b,{type:"Point",coordinates:this.toMap(g)});break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(this._mouseDown||this._toolPan)this._panMove();else{if(a>0){this._drawCoords[a-1]=this._toMap(g);this._drawPixels[a-
1]=g;this._refreshDrawing()}this._trigger("move",b,{type:"Point",coordinates:this.toMap(g)})}break;default:this._mouseDown||this._toolPan?this._panMove():this._trigger("move",b,{type:"Point",coordinates:this.toMap(g)})}this._lastMove=g;if(this._inOp){b.preventDefault();return false}}},_dragTarget_touchstop:function(b){if(this._options.mode!=="static"){!this._mouseDown&&r==7&&this._eventTarget_touchstart(b);var c=this._mouseDown,a=this._toolPan,d=this._$eventTarget.offset(),g=this._shiftZoom?"zoom":
this._options.mode,f,l;f=this._supportTouch?[b.originalEvent.changedTouches[0].pageX-d.left,b.originalEvent.changedTouches[0].pageY-d.top]:[b.pageX-d.left,b.pageY-d.top];d=f[0]-this._anchor[0];l=f[1]-this._anchor[1];this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;if(this._isMultiTouch){b.preventDefault();this._isMultiTouch=false;c=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,false);this._setCenterAndSize(c.center,
c.pixelSize,true,true);this._wheelLevel=0;return false}document.releaseCapture&&document.releaseCapture();if(c){c=e.now();this._current=f;switch(g){case "zoom":if(d>0||l>0){a=this._pixelSize*6;g=this._toMap([[Math.min(this._anchor[0],f[0]),Math.max(this._anchor[1],f[1])],[Math.max(this._anchor[0],f[0]),Math.min(this._anchor[1],f[1])]]);g=[g[0][0],g[0][1],g[1][0],g[1][1]];if(g[2]-g[0]<a&&g[3]-g[1]<a)g=e.geo.scaleBy(this._getBbox(e.geo.center(g,true)),0.5,true);this._setBbox(g,true,true)}this._resetDrawing();
break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(a)this._panFinalize();else if(c-this._clickDate>100){var m=this;this._drawTimeout=setTimeout(function(){if(m._drawTimeout){m._trigger("shape",b,{type:"Point",coordinates:m.toMap(f)});m._inOp=false;m._drawTimeout=null}},250)}break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(a)this._panFinalize();else{a=this._drawCoords.length==0?0:this._drawCoords.length-
1;this._drawCoords[a]=this._toMap(f);this._drawPixels[a]=f;if(a<2||!(this._drawCoords[a][0]==this._drawCoords[a-1][0]&&this._drawCoords[a][1]==this._drawCoords[a-1][1])){this._drawCoords[a+1]=this._toMap(f);this._drawPixels[a+1]=f}this._refreshDrawing()}break;default:if(a)this._panEnd();else if(c-this._clickDate>100){this._trigger("click",b,{type:"Point",coordinates:this.toMap(f)});this._inOp=false}}this._clickDate=c;if(this._softDblClick&&this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",
b)}}if(this._inOp){b.preventDefault();return false}}},_eventTarget_mousewheel:function(b,c){if(this._options.mode!=="static"){b.preventDefault();this._panFinalize();if(this._mouseDown||this._options.scroll==="off")return false;if(c!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var a=e(b.currentTarget).offset();this._anchor=[b.pageX-a.left,b.pageY-a.top]}this._wheelLevel+=c;a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=
null);var d,g=0;for(this._$elem.find(".geo-shapes-container").geographics("clear");g<this._currentServices.length;g++){d=this._currentServices[g];e.geo._serviceTypes[d.type].interactiveScale(this,d,a.center,a.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,a.center,a.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,a.center,a.pixelSize);
this._refreshDrawing()}var f=this;this._wheelTimeout=window.setTimeout(function(){f._mouseWheelFinish()},1E3)}return false}}})})(jQuery);
(function(e,q){e.geo._serviceTypes.tiled=function(){return{create:function(r,b,c){r=e.data(c,"geoServiceState");if(!r){r={loadCount:0,reloadTiles:false};b.append('<div data-geo-service="tiled" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>');r.serviceContainer=b.children(":last");e.data(c,"geoServiceState",r)}return r.serviceContainer},destroy:function(r,b,c){e.data(c,"geoServiceState").serviceContainer.remove();e.removeData(c,"geoServiceState")},interactivePan:function(r,
b,c,a){var d=e.data(b,"geoServiceState");if(d){this._cancelUnloaded(r,b);d.serviceContainer.children().css("-moz-transition","").css({webkitTransition:"",transition:"",left:function(R,U){return parseInt(U)+c},top:function(R,U){return parseInt(U)+a}});if(b&&b.style.visibility==="visible"){var g=r._pixelSize,f=this,l=d.serviceContainer,m=l.children("[data-pixelSize='"+g+"']"),n=r._getContentBounds(),t=r.options.axisLayout==="image",u=t?+1:-1,v=r.options.tilingScheme,B=v.tileWidth,G=v.tileHeight,F=n.width/
2*g,y=n.height/2*g,K=m.position(),D=m.data("scaleOrigin").split(",");n=parseInt(D[0])-K.left;K=parseInt(D[1])-K.top;var J=r._getCenter();D=[J[0]+n*g,J[1]+u*K*g];var P=Math.floor((D[0]-F-v.origin[0])/(g*B));n=Math.max(Math.floor((t?D[1]-y-v.origin[1]:v.origin[1]-(D[1]+y))/(g*G)),0);K=Math.ceil((D[0]+F-v.origin[0])/(g*B));D=Math.ceil((t?D[1]+y-v.origin[1]:v.origin[1]-(D[1]-y))/(g*G));var I=r._getBboxMax(),C=r._getPixelSize(0),H=C/g,M=Math.floor((I[0]-v.origin[0])/(C*B))*H;I=Math.floor((v.origin[1]+
u*I[3])/(C*G))*H;C=v.origin[1]+u*I*G*g;F=Math.round((v.origin[0]+M*B*g-(J[0]-F))/g);t=Math.round((t?C-(J[1]-y):J[1]+y-C)/g);var z=b.style.opacity;for(y=P;y<K;y++)for(J=n;J<D;J++){P=""+y+","+J;var L=m.children("[data-tile='"+P+"']").removeAttr("data-dirty");if(L.size()===0){C=[v.origin[0]+y*B*g,v.origin[1]+u*J*G*g];H=[v.origin[0]+((y+1)*B-1)*g,v.origin[1]+u*((J+1)*G-1)*g];H=[C[0],C[1],H[0],H[1]];C=b.hasOwnProperty("src")?"src":"getUrl";H={bbox:H,width:B,height:G,zoom:r._getZoom(),tile:{row:J,column:y},
index:Math.abs(J+y)};if(e.isFunction(b[C]))C=b[C](H);else{e.template("geoSrc",b[C]);C=e.render(H,"geoSrc")}d.loadCount++;if(d.reloadTiles&&L.size()>0)L.attr("src",C);else{H="<img style='position:absolute; left:"+((y-M)*100+(F-F%B)/B*100)+"%; top:"+((J-I)*100+(t-t%G)/G*100)+"%; ";if(e("body")[0].filters===q)H+="width: 100%; height: 100%;";H+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
P+"' />";m.append(H);L=m.children(":last")}typeof C==="string"?f._loadImage(L,C,g,d,l,z):C.done(function(R){f._loadImage(L,R,g,d,l,z)}).fail(function(){L.remove();d.loadCount--})}}}}},interactiveScale:function(r,b,c,a){var d=e.data(b,"geoServiceState");if(d&&b&&b.style.visibility==="visible"){this._cancelUnloaded(r,b);b=r.options.tilingScheme;var g=b.tileWidth,f=b.tileHeight;d.serviceContainer.children().each(function(){var l=e(this),m=l.attr("data-pixelSize")/a;m=Math.round(m*1E3)/1E3;var n=l.data("scaleOrigin").split(",");
n=r._toMap([n[0],n[1]]);n=r._toPixel(n,c,a);l.css("-moz-transition","").css({webkitTransition:"",transition:"",left:Math.round(n[0])+"px",top:Math.round(n[1])+"px",width:g*m,height:f*m});e("body")[0].filters!==q&&l.children().each(function(){e(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+m+",M22="+m+",sizingmethod='auto expand')")})})}},refresh:function(r,b){var c=e.data(b,"geoServiceState");this._cancelUnloaded(r,b);if(c&&b&&b.style.visibility==="visible"&&
!c.serviceContainer.is(":hidden")){var a=r._getBbox(),d=r._pixelSize,g=this,f=c.serviceContainer;r._getContentBounds();var l=r.options.axisLayout==="image",m=l?+1:-1,n=r.options.tilingScheme,t=n.tileWidth,u=n.tileHeight,v=Math.floor((a[0]-n.origin[0])/(d*t)),B=Math.max(Math.floor((l?a[1]-n.origin[1]:n.origin[1]-a[3])/(d*u)),0),G=Math.ceil((a[2]-n.origin[0])/(d*t)),F=Math.ceil((l?a[3]-n.origin[1]:n.origin[1]-a[1])/(d*u)),y=r._getBboxMax(),K=r._getPixelSize(0),D=K/d,J=Math.floor((y[0]-n.origin[0])/
(K*t))*D,P=Math.floor((n.origin[1]+m*y[3])/(K*u))*D;y=n.origin[1]+m*P*u*d;var I=Math.round((n.origin[0]+J*t*d-a[0])/d),C=Math.round((l?y-a[1]:a[3]-y)/d);a=f.children().show();l=a.filter("[data-pixelSize='"+d+"']").appendTo(f);var H=b.style.opacity;c.reloadTiles&&a.find("img").attr("data-dirty","true");if(l.size()){l.css({left:I%t+"px",top:C%u+"px"}).data("scaleOrigin",I%t+","+C%u);l.children().each(function(){var L=e(this),R=L.attr("data-tile").split(",");L.css({left:Math.round((parseInt(R[0])-J)*
100+(I-I%t)/t*100)+"%",top:Math.round((parseInt(R[1])-P)*100+(C-C%u)/u*100)+"%"});H<1&&L.fadeTo(0,H)})}else{f.append("<div style='position:absolute; left:"+I%t+"px; top:"+C%u+"px; width:"+t+"px; height:"+u+"px; margin:0; padding:0;' data-pixelSize='"+d+"'></div>");l=f.children(":last").data("scaleOrigin",I%t+","+C%u)}for(v=v;v<G;v++)for(y=B;y<F;y++){K=""+v+","+y;var M=l.children("[data-tile='"+K+"']").removeAttr("data-dirty");if(M.size()===0||c.reloadTiles){D=[n.origin[0]+v*t*d,n.origin[1]+m*y*u*
d];var z=[n.origin[0]+((v+1)*t-1)*d,n.origin[1]+m*((y+1)*u-1)*d];z=[D[0],D[1],z[0],z[1]];D=b.hasOwnProperty("src")?"src":"getUrl";z={bbox:z,width:t,height:u,zoom:r._getZoom(),tile:{row:y,column:v},index:Math.abs(y+v)};if(e.isFunction(b[D]))D=b[D](z);else{e.template("geoSrc",b[D]);D=e.render(z,"geoSrc")}c.loadCount++;if(c.reloadTiles&&M.size()>0)M.attr("src",D);else{z="<img style='position:absolute; left:"+((v-J)*100+(I-I%t)/t*100)+"%; top:"+((y-P)*100+(C-C%u)/u*100)+"%; ";if(e("body")[0].filters===
q)z+="width: 100%; height: 100%;";z+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+K+"' />";l.append(z);M=l.children(":last")}typeof D==="string"?g._loadImage(M,D,d,c,f,H):D.done(function(L){g._loadImage(M,L,d,c,f,H)}).fail(function(){M.remove();c.loadCount--})}}a.find("[data-dirty]").remove();c.reloadTiles=false}},resize:function(){},opacity:function(r,b){e.data(b,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
b.style.opacity)},toggle:function(r,b){e.data(b,"geoServiceState").serviceContainer.css("display",b.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(r,b){var c=e.data(b,"geoServiceState");if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--},_loadImage:function(r,b,c,a,d,g){r.load(function(f){g<1?e(f.target).fadeTo(0,g):e(f.target).show();a.loadCount--;if(a.loadCount<=0){d.children(":not([data-pixelSize='"+c+"'])").remove();a.loadCount=
0}}).error(function(f){e(f.target).remove();a.loadCount--;if(a.loadCount<=0){d.children(":not([data-pixelSize='"+c+"'])").remove();a.loadCount=0}}).attr("src",b)}}}()})(jQuery);
(function(e){e.geo._serviceTypes.shingled=function(){return{create:function(q,r,b){q=e.data(b,"geoServiceState");if(!q){q={loadCount:0};r.append('<div data-geo-service="shingled" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>');q.serviceContainer=r.children(":last");e.data(b,"geoServiceState",q)}return q.serviceContainer},destroy:function(q,r,b){e.data(b,"geoServiceState").serviceContainer.remove();e.removeData(b,"geoServiceState")},interactivePan:function(q,
r,b,c){var a=e.data(r,"geoServiceState");if(a){this._cancelUnloaded(q,r);r=a.serviceContainer;q=q._pixelSize;a=r.children("[data-pixelSize='"+q+"']");var d=a.children("div");if(!d.length){a.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');d=a.children("div")}d.css({left:function(g,f){return parseInt(f)+b},top:function(g,f){return parseInt(f)+c}});r.children(":not([data-pixelSize='"+q+"'])").remove()}},interactiveScale:function(q,r,b,c){var a=e.data(r,
"geoServiceState");if(a){this._cancelUnloaded(q,r);r=a.serviceContainer;q=q._getContentBounds();var d=q.width,g=q.height,f=d/2,l=g/2;r.children().each(function(){var m=e(this),n=m.attr("data-pixelSize"),t=n/c;m.css({width:d*t,height:g*t}).children("img").each(function(){var u=e(this),v=u.data("center");u.css({left:(Math.round((v[0]-b[0])/n)-f)*t+"px",top:(Math.round((b[1]-v[1])/n)-l)*t+"px"})})})}},refresh:function(q,r){var b=e.data(r,"geoServiceState");this._cancelUnloaded(q,r);if(b&&r&&r.style.visibility===
"visible"&&!b.serviceContainer.is(":hidden")){var c=q._getBbox(),a=q._pixelSize,d=this,g=b.serviceContainer,f=q._getContentBounds(),l=f.width,m=f.height,n=l/2,t=m/2;f=g.children('[data-pixelSize="'+a+'"]');var u=r.style.opacity,v;if(!f.size()){g.append('<div style="position:absolute; left:'+n+"px; top:"+t+"px; width:"+l+"px; height:"+m+'px; margin:0; padding:0;" data-pixelSize="'+a+'"></div>');f=g.children(":last")}f.children("img").each(function(){var G=e(this),F=G.data("center"),y=q._getCenter();
G.css({left:Math.round((F[0]-y[0])/a)-n+"px",top:Math.round((y[1]-F[1])/a)-t+"px"})});u<1&&g.find("img").attr("data-keepAlive","0");var B=r.hasOwnProperty("src")?"src":"getUrl";c={bbox:c,width:l,height:m,zoom:q._getZoom(),tile:null,index:0};if(e.isFunction(r[B]))c=r[B](c);else{e.template("geoSrc",r[B]);c=e.render(c,"geoSrc")}b.loadCount++;f.append('<img style="position:absolute; left:-'+n+"px; top:-"+t+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
v=f.children(":last").data("center",q._getCenter());typeof c==="string"?d._loadImage(v,c,a,b,g,u):c.done(function(G){d._loadImage(v,G,a,b,g,u)}).fail(function(){v.remove();b.loadCount--})}},resize:function(q,r){var b=e.data(r,"geoServiceState");if(b&&r&&r.style.visibility==="visible"){this._cancelUnloaded(q,r);var c=b.serviceContainer,a=q._getContentBounds();b=a.width/2;a=a.height/2;c=c.children();c.attr("data-pixelSize","0");c.css({left:b+"px",top:a+"px"})}},opacity:function(q,r){e.data(r,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
r.style.opacity)},toggle:function(q,r){e.data(r,"geoServiceState").serviceContainer.css("display",r.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(q,r){var b=e.data(r,"geoServiceState");if(b&&b.loadCount>0)for(b.serviceContainer.find("img:hidden").remove();b.loadCount>0;)b.loadCount--},_loadImage:function(q,r,b,c,a,d){q.load(function(g){d<1?e(g.target).fadeTo(0,d):e(g.target).show();c.loadCount--;if(c.loadCount<=0){a.children(':not([data-pixelSize="'+b+'"])').remove();g=a.find('[data-pixelSize="'+
b+'"]>div');if(g.size()>0){var f=g.position();g.children("img").each(function(){var l=e(this),m=f.left+parseInt(l.css("left")),n=f.top+parseInt(l.css("top"));l.css({left:m+"px",top:n+"px"})}).unwrap();g.remove()}c.loadCount=0}}).error(function(g){e(g.target).remove();c.loadCount--;if(c.loadCount<=0){a.children(":not([data-pixelSize='"+b+"'])").remove();c.loadCount=0}}).attr("src",r)}}}()})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)
